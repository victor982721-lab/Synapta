{
  "session": "postmortem-seeds-01-08",
  "scope": {
    "files": [
      "/mnt/data/seed01.psm1",
      "/mnt/data/seed02.psm1",
      "/mnt/data/seed03.psm1",
      "/mnt/data/seed04.psm1",
      "/mnt/data/seed05.psm1",
      "/mnt/data/seed06.psm1",
      "/mnt/data/seed07.psm1",
      "/mnt/data/seed08.psm1"
    ],
    "snapshots_dir_hint": "/mnt/data/postmortem_v5/snapshots/"
  },
  "observations": [
    {
      "file": "seed01.psm1",
      "findings": [
        {
          "rule": "R11",
          "severity": "Medium",
          "category": "Robustez",
          "line_hint": 12,
          "issue": "Cambio de CWD en un módulo usando Set-Location.",
          "why_it_matters": "Un módulo no debe alterar el directorio de trabajo del llamador. Rompe rutas relativas y efectos de entorno.",
          "fix": "Eliminar Set-Location y construir rutas con Join-Path $PSScriptRoot '<subruta>'.",
          "snapshot_hint": "seed01_12_R11.txt"
        },
        {
          "rule": "R08",
          "severity": "Low",
          "category": "Exactitud",
          "line_hint": 176,
          "issue": "Se consulta PSBoundParameters['OutputDir'] sin declarar el parámetro OutputDir en param().",
          "why_it_matters": "PSBoundParameters solo contiene parámetros realmente enlazados. La condición nunca se cumple.",
          "fix": "Declarar [string]$OutputDir en param() o retirar la lógica asociada.",
          "snapshot_hint": "seed01_176_R08.txt"
        },
        {
          "rule": "Q02",
          "severity": "Low",
          "category": "Calidad",
          "issue": "Falta Set-StrictMode.",
          "why_it_matters": "StrictMode detecta variables no inicializadas y errores silenciosos.",
          "fix": "Agregar Set-StrictMode -Version Latest al cargar el módulo."
        }
      ]
    },
    {
      "file": "seed02.psm1",
      "findings": [
        {
          "rule": "R11",
          "severity": "Medium",
          "category": "Robustez",
          "line_hint": 17,
          "issue": "Set-Location en módulo.",
          "why_it_matters": "Modifica el CWD del consumidor.",
          "fix": "Usar $PSScriptRoot para rutas.",
          "snapshot_hint": "seed02_17_R11.txt"
        },
        {
          "rule": "Q02",
          "severity": "Low",
          "category": "Calidad",
          "issue": "Falta Set-StrictMode.",
          "fix": "Agregar Set-StrictMode -Version Latest."
        },
        {
          "rule": "R04",
          "severity": "Low",
          "category": "Robustez",
          "issue": "Operaciones sin -ErrorAction Stop.",
          "why_it_matters": "Errores no detenidos complican la recuperación y el reporte.",
          "fix": "Usar -ErrorAction Stop en operaciones críticas y try/catch."
        }
      ]
    },
    {
      "file": "seed03.psm1",
      "findings": [
        {
          "rule": "R11",
          "severity": "Medium",
          "category": "Robustez",
          "line_hint": 19,
          "issue": "Set-Location en módulo.",
          "fix": "Sustituir por rutas con $PSScriptRoot."
        },
        {
          "rule": "Q02",
          "severity": "Low",
          "category": "Calidad",
          "issue": "Falta Set-StrictMode.",
          "fix": "Agregar Set-StrictMode -Version Latest."
        }
      ]
    },
    {
      "file": "seed04.psm1",
      "findings": [
        {
          "rule": "R11",
          "severity": "Medium",
          "category": "Robustez",
          "line_hint": 25,
          "issue": "Set-Location en módulo.",
          "fix": "Rutas con $PSScriptRoot."
        },
        {
          "rule": "Q02",
          "severity": "Low",
          "category": "Calidad",
          "issue": "Falta Set-StrictMode.",
          "fix": "Agregar Set-StrictMode -Version Latest."
        },
        {
          "rule": "R04",
          "severity": "Low",
          "category": "Robustez",
          "issue": "Sin -ErrorAction Stop en operaciones clave.",
          "fix": "Añadir -ErrorAction Stop y try/catch."
        }
      ]
    },
    {
      "file": "seed05.psm1",
      "findings": [
        {
          "rule": "R11",
          "severity": "Medium",
          "category": "Robustez",
          "line_hint": 19,
          "issue": "Set-Location en módulo.",
          "fix": "Rutas con $PSScriptRoot."
        },
        {
          "rule": "Q02",
          "severity": "Low",
          "category": "Calidad",
          "issue": "Falta Set-StrictMode.",
          "fix": "Agregar Set-StrictMode -Version Latest."
        }
      ]
    },
    {
      "file": "seed06.psm1",
      "findings": [
        {
          "rule": "R11",
          "severity": "Medium",
          "category": "Robustez",
          "line_hint": 19,
          "issue": "Set-Location en módulo.",
          "fix": "Rutas con $PSScriptRoot."
        },
        {
          "rule": "R06",
          "severity": "Medium",
          "category": "Calidad",
          "issue": "Exportación dinámica: Export-ModuleMember -Function $exports.",
          "why_it_matters": "No se verifica estáticamente la superficie pública.",
          "fix": "Validar que $exports contenga solo funciones definidas y conocidas antes de exportar."
        },
        {
          "rule": "Q02",
          "severity": "Low",
          "category": "Calidad",
          "issue": "Falta Set-StrictMode.",
          "fix": "Agregar Set-StrictMode -Version Latest."
        },
        {
          "rule": "R04",
          "severity": "Low",
          "category": "Robustez",
          "issue": "Operaciones sin -ErrorAction Stop.",
          "fix": "Añadir -ErrorAction Stop y try/catch."
        }
      ]
    },
    {
      "file": "seed07.psm1",
      "findings": [
        {
          "rule": "R11",
          "severity": "Medium",
          "category": "Robustez",
          "line_hint": 17,
          "issue": "Set-Location en módulo.",
          "fix": "Rutas con $PSScriptRoot."
        },
        {
          "rule": "Q02",
          "severity": "Low",
          "category": "Calidad",
          "issue": "Falta Set-StrictMode.",
          "fix": "Agregar Set-StrictMode -Version Latest."
        },
        {
          "rule": "R04",
          "severity": "Low",
          "category": "Robustez",
          "issue": "Sin -ErrorAction Stop.",
          "fix": "Añadir -ErrorAction Stop y try/catch."
        }
      ]
    },
    {
      "file": "seed08.psm1",
      "findings": [
        {
          "rule": "R11",
          "severity": "Medium",
          "category": "Robustez",
          "line_hint": 17,
          "issue": "Set-Location en módulo.",
          "fix": "Rutas con $PSScriptRoot."
        },
        {
          "rule": "Q02",
          "severity": "Low",
          "category": "Calidad",
          "issue": "Falta Set-StrictMode.",
          "fix": "Agregar Set-StrictMode -Version Latest."
        },
        {
          "rule": "R03",
          "severity": "Low",
          "category": "Robustez",
          "issue": "Faltan bloques try/catch en operaciones susceptibles.",
          "fix": "Envolver operaciones críticas con try/catch y registrar errores."
        },
        {
          "rule": "R04",
          "severity": "Low",
          "category": "Robustez",
          "issue": "Sin -ErrorAction Stop.",
          "fix": "Añadir -ErrorAction Stop."
        }
      ]
    }
  ],
  "common_fixes": [
    "Eliminar Set-Location de todos los .psm1 y usar $PSScriptRoot + Join-Path.",
    "Agregar Set-StrictMode -Version Latest al cargar cada módulo.",
    "Usar -ErrorAction Stop y try/catch en operaciones críticas.",
    "Validar listas dinámicas antes de Export-ModuleMember.",
    "Declarar parámetros consultados en PSBoundParameters."
  ]
}
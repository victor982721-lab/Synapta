# PowerShell (PS7) — Genera un .md con riesgos de root y escenarios de incomunicación
# Propósito: crear el documento en el Escritorio del usuario solicitado.
# Entorno objetivo: Windows 10 Pro 10.0.19045 64-bit, PowerShell 7.5.3 Core.
# Salida: C:\Users\VictorFabianVeraVill\Desktop\Riesgos_Root_Comunicacion.md

$ErrorActionPreference = 'Stop'
try {
    $destDir  = 'C:\Users\VictorFabianVeraVill\Desktop'
    $outPath  = Join-Path $destDir 'Riesgos_Root_Comunicacion.md'
    Set-Location $destDir

    if (-not (Test-Path -LiteralPath $destDir)) {
        Write-Progress -Activity 'Preparando entorno' -Status 'Creando directorio' -PercentComplete 10
        New-Item -ItemType Directory -Path $destDir -Force | Out-Null
    }

    Write-Progress -Activity 'Generando documento' -Status 'Compilando contenido' -PercentComplete 40

    $md = @"
# Riesgos de rootear un celular y cómo puedes quedar incomunicado

## Resumen ejecutivo
Rootear un dispositivo Android otorga privilegios de superusuario. Esta capacidad permite personalizar profundamente el sistema, pero amplifica el riesgo de errores técnicos, incompatibilidades y fallos de seguridad. Varias de esas fallas afectan directamente la **capacidad de comunicarte**: sin señal móvil, sin datos, sin SMS para códigos de verificación, sin VoLTE/VoWiFi, o incluso con el equipo inoperable. Este documento explica **por qué** ocurre, **cómo** evitarlo y **qué** hacer si ya sucedió.

## Conceptos base (mapa mínimo)
- **Bootloader**: cargador de arranque. Desbloquearlo suele **borrar el dispositivo** y puede activar mecanismos anticopia o de integridad.
- **Root**: privilegios de superusuario. Suele inyectarse a través de parches a `boot.img` o con módulos en el arranque.
- **Recovery**: entorno de mantenimiento. Stock u otros (p. ej., TWRP).
- **Vendor/ODM**: capas específicas del fabricante. Deben ser **compatibles** con kernel y sistema.
- **Modem/Baseband/Radio**: firmware del subsistema celular. Si no coincide con tu región/modelo/versión, se rompe la conectividad.
- **EFS/NVRAM/Modemst**: particiones con **IMEI**, certificados, configuración de radio y eSIM. Si se corrompen, el **módem no registra** en la red.
- **AVB/DM-Verity/VBMeta**: integridad de arranque. Si se deshabilita mal, el sistema puede entrar en bucles o degradar seguridad.
- **SELinux**: política de seguridad. Pasar a **Permissive** puede facilitar ataques y fallos silenciosos.

## Riesgos técnicos que sí te dejan sin comunicación

### 1) Corrupción o pérdida de EFS/NVRAM (IMEI nulo o genérico)
**Qué pasa:** el equipo muestra IMEI vacío/000000… y “Baseband Unknown”. La red rechaza el registro y quedas sin señal, SMS ni datos.  
**Causas típicas:** flasheo indebido, wipes erróneos, incompatibilidades de ROM/vendor, herramientas de particionado no confiables.  
**Prevención:** copia de seguridad de EFS/NVRAM/modemst1–2 antes de modificar. Guardar copia **offline**.  
**Recuperación:** restaurar **exacta** la copia EFS; si no existe, solo el servicio técnico u operaciones avanzadas con herramientas del fabricante podrían reescribir datos válidos.

### 2) Módem/Baseband incompatible o ausente
**Qué pasa:** “Sin servicio”, llamadas que no conectan, datos que no activan, redes que aparecen/desaparecen.  
**Causas:** ROM personalizada que no incluye modem apropiado, mezcla de componentes (kernel/vendor/system) de distintas versiones, o actualización OTA interrumpida que dejó el **CP** (módem) inválido.  
**Prevención:** usar siempre **firmware de tu modelo y región**; mantener el módem stock compatible con la versión de sistema.  
**Recuperación:** flashear el **modem/CP correcto** para tu dispositivo/región/operador.

### 3) eSIM borrada por desbloqueo de bootloader o wipes
**Qué pasa:** el perfil eSIM se elimina al desbloquear el bootloader o al aplicar wipes profundos. Te quedas sin línea si no tienes SIM física de respaldo.  
**Prevención:** solicitar al operador el **QR de reaprovisionamiento**, guardar respaldo de información de línea, o usar SIM física durante el proceso.  
**Recuperación:** reprovisionar eSIM con el operador. Puede requerir acudir a un centro de atención y **documentación** del titular.

### 4) RIL/IMS mal configurados: sin VoLTE/VoWiFi y llamadas fallidas
**Qué pasa:** en redes que ya dependen de VoLTE, las llamadas no cursan o solo tienes “solo emergencia”. SMS sobre IMS también puede fallar.  
**Causas:** ROM sin perfiles IMS del operador, `build.prop` o props del sistema alteradas, módulos que cambian fingerprint o carrier configs.  
**Prevención:** elegir ROMs que **declaren soporte** para tu operador o mantener vendor/carrier configs stock.  
**Recuperación:** reinstalar perfiles IMS correctos, restaurar vendor compatible, o volver a firmware stock.

### 5) APN borrados o erróneos
**Qué pasa:** sin datos móviles ni MMS.  
**Causas:** wipes, ROMs que resetean APN, cambios de carrier config.  
**Prevención:** **Anota** tus APN antes de modificar.  
**Recuperación:** reingresar APN oficiales del operador.

### 6) Bootloop o soft-brick
**Qué pasa:** el teléfono no inicia. Pierdes llamadas, SMS, datos, mensajería y 2FA.  
**Causas:** parches de `boot.img` incompatibles, módulos root conflictivos, AVB deshabilitado incorrectamente.  
**Prevención:** probar cambios **de uno en uno** y con respaldo de arranque/ROM.  
**Recuperación:** reflashear `boot.img` stock, deshabilitar módulos, restaurar nandroid o ROM limpia.

### 7) Particiones persistentes dañadas
**Qué pasa:** fallos en Wi-Fi/Bluetooth, dirección MAC “desconocida”, sensores que no inician, o radio inconsistente.  
**Causas:** wipes a particiones de **persist** y similares sin guía del fabricante.  
**Prevención:** nunca formatear particiones persistentes sin respaldo y motivo claro.  
**Recuperación:** restaurar respaldo; de lo contrario, servicio técnico.

### 8) Anti-rollback y verificaciones de integridad
**Qué pasa:** el equipo se niega a iniciar con imágenes “más antiguas” o alteradas. Sin sistema no hay comunicación.  
**Prevención:** verificar **bootloader level**/anti-rollback antes de flashear.  
**Recuperación:** usar imágenes igual o superiores y vbmeta adecuados.

## Riesgos funcionales que afectan apps de comunicación

### 9) Play Integrity/SafetyNet fallido
**Qué pasa:** apps corporativas, bancarias, de operador o de autenticación pueden **bloquearse**. Si dependes de esas apps para activar eSIM, VoWiFi o recibir OTP, quedas sin acceso práctico.  
**Prevención:** entender que root rompe garantías de integridad. Algunas mitigaciones existen, pero no son universales ni garantizadas.  
**Recuperación:** volver a estado “stock” o usar un dispositivo secundario para OTP y gestiones críticas.

### 10) Pérdida de 2FA por borrado de datos
**Qué pasa:** al desbloquear bootloader se **borra el teléfono**. Si tus llaves 2FA y respaldos estaban solo allí, no puedes recuperar cuentas, mensajería o eSIM.  
**Prevención:** **Códigos de respaldo** impresos, números alternativos, correo de recuperación, llaves FIDO físicas.  
**Recuperación:** procesos de verificación con cada servicio. Pueden tardar días.

### 11) ROMs sin servicios de Google o con microservicios no oficiales
**Qué pasa:** notificaciones push y registro RCS pueden fallar o degradarse.  
**Prevención:** confirmar soporte de notificaciones y RCS en la ROM elegida.

## Casos típicos de “incomunicación”
- **IMEI nulo + Baseband Unknown:** no hay red, SMS ni datos.  
- **eSIM eliminada + sin QR de reprovisionamiento:** sin línea hasta coordinar con el operador.  
- **Wrong modem/CP:** el teléfono ve la red pero no registra o se cae la señal.  
- **Sin VoLTE en red que lo exige:** llamadas imposibles; solo datos (si acaso).  
- **Bootloop tras parche de boot:** el equipo no arranca.  
- **Borrado por desbloqueo + pérdida de 2FA:** sin acceso a cuentas, mensajería y servicios críticos.

## Matriz de riesgo simplificada
- **Probabilidad Alta / Impacto Alto:** EFS dañado; bootloop; eSIM borrada sin respaldo.  
- **Probabilidad Media / Impacto Alto:** modem incompatible; IMS roto.  
- **Probabilidad Media / Impacto Medio:** APN perdidos; SafetyNet fallido que bloquea apps del operador.  
- **Probabilidad Baja / Impacto Alto:** anti-rollback que impide iniciar sin imagen correcta.

## Checklist preventivo antes de rootear
1) **Respaldos críticos:** EFS/NVRAM/modemst/persist; nandroid; fotos de APN; QR eSIM; códigos 2FA.  
2) **Firmware a mano:** paquete **stock** completo por si necesitas restaurar módem/vendor.  
3) **Compatibilidad:** ROM, kernel, vendor y módem **de la misma rama** y región.  
4) **Plan B de comunicación:** SIM física adicional o teléfono secundario para OTP.  
5) **Cambios graduales:** un ajuste por vez, con pruebas de **llamada/SMS/datos** tras cada cambio.  
6) **Documenta:** versión de baseband, IMEI, build exacta y operador configurado.

## Diagnóstico rápido si ya estás incomunicado
- Marca *#06# y revisa **IMEI**. Si vacío → foco en EFS.  
- Ajustes > Información del teléfono → **Versión de banda base**. Si “Desconocida” → módem.  
- Configuración de **APN**: compara con los oficiales del operador.  
- Comprueba si tu red requiere **VoLTE** y si tu ROM lo habilita.  
- Prueba otra SIM o un teléfono secundario para aislar el problema.  
- Considera revisar registros del radio (por técnicos): errores de registro, rechazo por red, IMS no aprovisionado.

## Plan de contingencia sugerido (30–60 minutos)
1) Restablece **boot y vbmeta stock** si modificaste arranque.  
2) Flashea el **modem/CP correcto** para tu modelo y región.  
3) Restaura **EFS** desde tu respaldo; si no hay, no sobrescribas más y busca asistencia profesional.  
4) Reconfigura **APN** oficiales.  
5) Reprovisiona **eSIM** con tu operador o usa SIM física temporal.  
6) Verifica **VoLTE/IMS** activos; si tu ROM no los soporta, vuelve a stock.  
7) Prueba **llamadas, SMS y datos** antes de reinstalar módulos root o tweaks.

## Consideraciones por fabricante
- **Samsung**: flashear y rootear **activa KNOX** permanentemente. Algunas funciones quedan deshabilitadas. Mantén a mano el **CP** correcto; si pierdes IMS/VoLTE, volver a stock suele ser el camino corto.  
- **Xiaomi/Redmi/Poco**: tiempos de espera para desbloqueo; evita wipes a particiones persistentes.  
- **Pixel**: proceso relativamente limpio, pero respeta AVB y revisa compatibilidad de boot/system/vendor.

## Conclusión
Rootear no es “malo” por sí mismo, pero **eleva exponencialmente** el costo de un error. Los daños en EFS/modem/IMS o un desbloqueo sin plan de respaldo pueden dejarte **sin red, sin llamadas y sin SMS** justo cuando más lo necesitas. Si decides proceder, entra con: respaldos verificados, firmware stock disponible, un plan alterno de comunicación y la disciplina de probar cada paso.

"@

    Write-Progress -Activity 'Generando documento' -Status 'Escribiendo archivo' -PercentComplete 90
    Set-Content -LiteralPath $outPath -Value $md -Encoding UTF8

    Write-Progress -Activity 'Generando documento' -Completed
    "Documento creado: $outPath"
}
catch {
    Write-Error "Error al generar el documento: $($_.Exception.Message)"
    throw
}